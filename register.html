
<!DOCTYPE html>
<meta charset="utf-8">
<html lang="lt">

<h2>sukurk paskyrą</h2>
<p>
    <form action="/room" method="post" id="registerForm">
    <p>vardas:<input type = "text" name="name" id="name"></p>
    <p>slaptažodis:<input type="password" id = "passwordInput"></p>
    <p><small>rodyti slaptažodį<input type="checkbox" onclick="showPassword()" autocomplete="off"></small></p>

    <input type="submit" value="prisiregistruoti">
    </form>
    <p style="color:red" id="usernameError"></p>
</p>

<a href="/">jau turi paskyrą?</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
<script src="script.js"></script>
<script>
    function showPassword(){
        var x = document.getElementById("passwordInput");
        if (x.type === "password") {
            x.type = "text";
        } else {
            x.type = "password";
        }
    }
    document.getElementById("registerForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent form submission

        // Get the entered username
        var username = document.getElementById("name").value;
        var password = hashPassword(document.getElementById("passwordInput").value);

        // Send an AJAX request to the server to check if the username exists
        fetch("/tryRegister", {
            method: "POST",
            headers: {
            "Content-Type": "application/json"
            },
            body: JSON.stringify({ username: username, password:password})
        })
            .then(response => response.json())
            .then(data =>{
            if (data.message == "taken") {
                // Display the error message
                document.getElementById("usernameError").textContent = "šis vardas jau egzistuoja";
            } else {
                // Clear the error message and submit the form
                document.getElementById("usernameError").textContent = "";
                this.submit();
            }
            });
        });
</script>